# Setup & Run

1. Storage
    - Setup **MinIO** and create bucket, bucket is configured in the `client` param of `backend/api/dl_model_util/image_processor.py`

2. DB
    - Setup **PostgreSQL**, SQL URL is configured in the `URL_SOURCE` param of `backend/db/db_setup.py`
    - Setup [pgvector](https://github.com/pgvector/pgvector).
    - Use **Alembic** for db migration.
        ```sh
        # # Initialize alembic
        # alembic init alembic
        # # Then configure the `sqlalchemy.url` in alembic.ini file
        # # Then add the following lines to alembic/env.py
        # # # from main import Base
        # # # from db.models.db_model import *

        # # Generate alembic db migration scripts
        # alembic revision --autogenerate -m "comment"

        # # Execute alembic db migration (to the newest version)
        # alembic upgrade head
        ```

3. Python Env
    - (Use **Poetry** to)Install packages configured in `backend/pyproject.toml`
        ```sh
        poetry install
        ```

4. Download e5 Model
    - The NLP model should be downloaded and put to `backend/api/dl_models_util/multilingual-e5-large-instruct/`, which can be found [in Huggingface](https://huggingface.co/intfloat/multilingual-e5-large-instruct).

5. **Run Server**
    - Start backend server(debug mode)
        ```sh
        uvicorn main:app --reload --port 8001
        ```

# Codebase in Detail

## General

1. `backend/db/db_setup.py`: Config db URL, manage db connection
2. `backend/alembic/`: Auto generated by alembic

## CRUD Stuff Specific

For *xxx* CRUD functionality, follow the following steps to trace:

1. `backend/pydantic_schemas/pydantic_schema.py`: Pydantic models
2. `backend/db/models/db_model.py`: SqlAlchemy models
3. `backend/api/xxx.py`: Router settings
4. `backend/api/*util*/`: helper functions

## ML Model

- **OCR Model**: We use [RapidOCR](https://rapidai.github.io/RapidOCRDocs/docs/quickstart/) in `backend/api/dl_models_util/image_processor.py` as OCR engine.
- **NLP Model**: The DL model *(intfloat/multilingual-e5-large-instruct)* is used in `backend/api/dl_models_util/text_summarizer.py`.

# Referred Template Tutorial

[(Faraday Academy) Fast API Crash Course Code-along | Build an app with Postgres, SQL Alchemy, Async, and more](https://www.youtube.com/watch?v=gQTRsZpR7Gw)
