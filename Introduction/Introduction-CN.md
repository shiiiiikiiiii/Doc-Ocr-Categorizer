## 简介

### 开发顺序

> 敏捷开发
> 
> 第一版实现: 文档上传和查看, OCR模型, NLP模型, 文档分类
>
> 之后考虑添加: 用户以及权限控制, 文档库

### 目标与背景

本项目的主要目标是设计一个智能文档自动识别与分类系统，利用OCR技术识别文档，结合NLP模型和推荐算法, 实现对文档的智能化处理。

```text
面对现代科技与信息化的不断提高，大学生在大学阶段产生的文档材料不断增多，例如成绩单、社团申请书、学生档案等。传统的手动整理文档工作效率低下，需要人员持续监督，增加了人力成本。因此，通过结合OCR技术和NLP深度学习算法，我们可以将这些文档自动化地分类、识别和管理，提高工作效率。
```

### 项目特色

- **智能分类：** 利用OCR技术将扫描版文档转换为文本，并通过推荐算法和NLP方法实现文档的自动分类。

- **推荐系统：** 基于用户上传文档的历史记录，引入推荐算法为文档自动分类提供参考，提高分类准确性。

- **用户友好界面：** 设计一个直观、易用的用户界面，使用户能够方便地上传和处理文档，并查看识别和分类的结果。

- **多层次管理**
  
  > 1. **文档库**层次 **(Not yet implemented)**:文档库是最高一个层次,用于组织和管理多个文档分类。每个文档库下可以包含多个文档分类。例如可以建立学生文档库、医院文档库，这样每个库可以分别设置权限。
  2. **文档分类**层次:文档分类属于特定的一个文档库,一个文档分类下可以包含多个文档。例如学生文档库下分类可能包括社团申请书分类、成绩单分类、学籍分类。
  3. **文档**层次:文档属于一个特定的文档分类,是最基础的管理单位。任何单个文档都属于此层次。

### 技术选择

- **前端:** React, Antd
- **后端:** FastAPI
- **关系数据库:** PostgreSQL
- **存储服务:** MinIO
- **OCR算法:** RapidOCR
- **NLP算法:** multilingual-e5-large-instruct
- **推荐算法:** pgvector

## OCR与NLP具体模型选择和调试计划

1. _由于PaddleOCR部署和调用不是很方便,_ 选用了基于PaddleOCR, 但是更方便部署的**RapidOCR**
2. 使用**intfloat/multilingual-e5-large-instruct**模型, 使用**sentence-embedding**方法, 将OCR结果提取为向量

### 推荐算法进行文档分类推荐

- 使用PgSQL插件**pgvector**, 实现基于向量相似度的推荐

## API列表

### 文档相关API

1. **上传文档：**
   
   - `POST /upload` - 上传扫描版文档图片，自动进行OCR和NLP处理，自动分类。

2. **获取文档列表：**
   
   - `GET /documents` - 获取所有已上传文档。

3. **获取文档详情：**
   
   - `GET /documents/{id}` - 获取特定文档的各种信息, 包括所属分类, OCR识别结果等。

4. **删除文档：**
   
   - `DELETE /documents/{id}` - 删除特定文档。

5. **根据名称检索文档：**
   
   - `GET /documents/search/{search_name}` - 根据名称检索文档。

6. **修改文档：**
   
   - `PATCH /documents/{id}` - 手动修改特定文档的信息, 如名称, 所属的类别。

### 图片相关API

1. **根据文档ID获取图片URL：**

   - `GET /images/{document_id}` - 根据文档ID获取对应图片URL。

### 文档分类相关API

1. **获取文档分类列表：**
   
   - `GET /categories` - 获取所有文档分类。

2. **添加文档分类：**
   
   - `POST /categories` - 手动添加文档分类。

3. **修改文档分类：**
   
   - `PATCH /categories/{id}` - 手动修改特定文档分类。

4. **删除文档分类：**
   
   - `DELETE /categories/{id}` - 删除特定文档分类.

5. **检索特定文档分类下的所有文档：**
   
   - `GET /categories/{id}/documents` - 检索特定文档分类下的所有文档。

## 后端

### 后端数据库

#### 数据库表结构设计

1. **image表：**

  - `id` - 图片唯一标识符
  - `file_key`: sqlalchemy_utils.URLType - 存储在MinIO中的图片文件的唯一标识符
  - `document_id` - 外键关联到document表，表示该图片属于哪个文档

2. **document表：**

  - `id` - 文档唯一标识符
  - `name` - 文档名称
  - `ocr_result` - PgSQL的JSON类型，存储OCR模型提取的key-value形式的结果
  - `nlp_result` - pgvector插件的vector类型, 存储NLP模型做embedding的结果
  - `category_id` - 文档分类作为外键关联到category表

1. **category表：**

  - `id` - 分类唯一标识符
  - `name` - 分类名称
  - `description` - 分类描述


#### 图片存储

图片存储到MinIO数据库, 供这个表查找

```markdown
**image表：**

- `file_key` - 存储在MinIO中的图片文件的唯一标识符
```

## 前端页面设计

### 页面

#### **首页**

  - 显示欢迎词

#### **上传文档页面**

  - 页面布局：提供上传文档按钮。
  - 交互设计：上传后，系统自动进行OCR、NLP和自动分类处理。上传处理过程中，页面会暂时阻塞等待后端执行算法。等后端处理完当前文档，将对应数据传回前端之后，在页面上弹出这个文档的 _文档详情 modal_ 。

#### **搜索文档页面**

  - 页面布局：顶部提供一个搜索框，用户可以输入关键词进行搜索。
  - 交互设计：搜索结果以列表形式展示，每个结果旁边有"查看详情"按钮。点击后，弹出对应的 _文档详情 modal_。

#### **文档分类管理页面**

1. 文档分类管理页面
    - 页面布局：采用卡片式布局，每个卡片展示一个文档分类。
    - 交互设计：用户点击分类卡片，页面跳转到对应的文档分类详情页面。
    - 在页面上提供"添加"操作按钮, 点击后弹出 _dialog_, 可以输入名称添加一个文档分类
    - 在每个分类卡片上提供"详情"、"编辑"、"删除"操作的按钮，允许用户进行相应的改名和删除操作。

      - 详情按钮: 跳转到对应的文档分类详情页面
      - 编辑按钮: 点击后弹出 _dialog_, 可以输入名称
      - 删除按钮: 点击后弹出 _popconfirm_, 其中包含确定和取消按钮, 如果再次点击确定按钮则执行删除

2. 子页面： **文档分类详情页面**

    - 页面布局：以卡片形式展示该分类下的所有文档。
    - 在每个文档卡片上提供"查看 / 编辑"、"删除"操作的按钮，允许用户进行相应的改名和删除操作。

      - 查看 / 编辑按钮: 点击后弹出 _文档详情 modal_
      - 删除按钮: 点击后弹出 _popconfirm_, 其中包含确定和取消按钮, 如果再次点击确定按钮则执行删除

### 组件

1. **文档详情模态对话框**

    - 对话框内容：展示文档的OCR识别结果、分类信息、图片存储URL等信息。
    - 操作选项：支持点击URL预览图片，以及关闭对话框的选项，提交 _modal_ 时根据其中的信息修改文档对应的信息。

      - 提交按钮: 根据 _modal_ 中的信息修改文档对应的信息
      - 取消按钮: 退出 _modal_

2. **导航栏**

    - 设计：导航栏固定在页面的左侧，垂直布局。
    - 内容：包含以下按钮：

      - 首页：跳转到首页。
      - 上传文档：跳转到上传文档页面。
      - 搜索文档：跳转到搜索文档页面。
      - 文档分类管理：跳转到文档分类管理页面。

    - 通过配置`frontend/.umirc.ts`中的`routes`参数来实现
