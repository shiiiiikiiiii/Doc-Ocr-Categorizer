*Automatically translated by LLM.*

> Here is the English translation, keeping the format:

## Introduction

### Development Sequence

> Agile development
>
> First version implementation: Document upload and viewing, OCR model, NLP model, document classification
>
> Later consider adding: User and permission control, document library

### Goals and Background

The main goal of this project is to design an intelligent document automatic recognition and classification system, using OCR technology to recognize documents, combined with NLP models and recommendation algorithms, to achieve intelligent processing of documents.

```text
Faced with the continuous advancement of modern science and technology and informatization, the number of document materials generated by college students during the university stage is increasing, such as transcripts, club application forms, student records, etc. The traditional manual document sorting work is inefficient and requires continuous supervision by personnel, increasing labor costs. Therefore, by combining OCR technology and NLP deep learning algorithms, we can automatically classify, recognize, and manage these documents, improving work efficiency.
```

### Project Features

- **Intelligent Classification:** Use OCR technology to convert scanned documents to text, and automatically classify documents through recommendation algorithms and NLP methods.

- **Recommendation System:** Based on the user's history of uploaded documents, recommendation algorithms are introduced to provide references for automatic document classification, improving classification accuracy.

- **User-Friendly Interface:** Design an intuitive and easy-to-use user interface, allowing users to conveniently upload and process documents, and view the recognition and classification results.

- **Multi-level Management**

  > 1. **Document Library** level **(Not yet implemented)**: The document library is the highest level, used for organizing and managing multiple document classifications. Each document library can contain multiple document classifications. For example, a student document library and a hospital document library can be established, allowing each library to set permissions separately.
  > 2. **Document Classification** level: Document classification belongs to a specific document library, and one document classification can contain multiple documents. For example, under the student document library, classifications may include club application form classification, transcript classification, and student status classification.
  > 3. **Document** level: Documents belong to a specific document classification and are the most basic management unit. Any individual document belongs to this level.

### Technology Choices

- **Frontend:** React, Antd
- **Backend:** FastAPI
- **Relational Database:** PostgreSQL
- **Storage Service:** MinIO
- **OCR Algorithm:** RapidOCR
- **NLP Algorithm:** multilingual-e5-large-instruct
- **Recommendation Algorithm:** pgvector

## Specific OCR and NLP Model Selection and Debugging Plan

1. _Since PaddleOCR deployment and invocation is not very convenient,_ the more easily deployed **RapidOCR** based on PaddleOCR was chosen.
2. Use the **intfloat/multilingual-e5-large-instruct** model, using the **sentence-embedding** method to extract the OCR result into vectors.

### Using Recommendation Algorithm for Document Classification Recommendation

- Use the PgSQL plugin **pgvector** to implement recommendation based on vector similarity.

## API List

### Document-Related APIs

1. **Upload Document:**

   - `POST /upload` - Upload scanned document images, automatically perform OCR and NLP processing, and automatically classify.

2. **Get Document List:**

   - `GET /documents` - Get all uploaded documents.

3. **Get Document Details:**

   - `GET /documents/{id}` - Get various information about a specific document, including its classification, OCR recognition result, etc.

4. **Delete Document:**

   - `DELETE /documents/{id}` - Delete a specific document.

5. **Search Documents by Name:**

   - `GET /documents/search/{search_name}` - Search for documents by name.

6. **Modify Document:**

   - `PATCH /documents/{id}` - Manually modify information of a specific document, such as name and classification.

### Image-Related APIs

1. **Get Image URL by Document ID:**

   - `GET /images/{document_id}` - Get the image URL corresponding to the document ID.

### Document Classification-Related APIs

1. **Get Document Classification List:**

   - `GET /categories` - Get all document classifications.

2. **Add Document Classification:**

   - `POST /categories` - Manually add a document classification.

3. **Modify Document Classification:**

   - `PATCH /categories/{id}` - Manually modify a specific document classification.

4. **Delete Document Classification:**

   - `DELETE /categories/{id}` - Delete a specific document classification.

5. **Search for All Documents Under a Specific Document Classification:**

   - `GET /categories/{id}/documents` - Search for all documents under a specific document classification.

## Backend

### Backend Database

#### Database Table Structure Design

1. **image table:**

   - `id` - Unique identifier for the image
   - `file_key`: sqlalchemy_utils.URLType - Unique identifier of the image file stored in MinIO
   - `document_id` - Foreign key associated with the document table, indicating which document the image belongs to

2. **document table:**

   - `id` - Unique identifier for the document
   - `name` - Document name
   - `ocr_result` - PostgreSQL JSON type, storing the key-value results extracted by the OCR model
   - `nlp_result` - pgvector plugin's vector type, storing the embedding result of the NLP model
   - `category_id` - Document classification as a foreign key associated with the category table

3. **category table:**

   - `id` - Unique identifier for the classification
   - `name` - Classification name
   - `description` - Classification description

#### Image Storage

Images are stored in the MinIO database, referenced by this table:

```markdown
**image table:**

- `file_key` - Unique identifier of the image file stored in MinIO
```

## Frontend Page Design

### Pages

#### **Home Page**

   - Display a welcome message.

#### **Upload Document Page**

   - Page Layout: Provide an upload document button.
   - Interaction Design: After uploading, the system automatically performs OCR, NLP, and automatic classification processing. During the upload processing, the page will be temporarily blocked waiting for the backend to execute the algorithms. Once the backend finishes processing the current document and sends the corresponding data back to the frontend, a _Document Details modal_ for this document will pop up on the page.

#### **Search Document Page**

   - Page Layout: Provide a search box at the top for users to enter keywords for searching.
   - Interaction Design: Search results are displayed in a list format, with a "View Details" button next to each result. Clicking the button will pop up the corresponding _Document Details modal_.

#### **Document Classification Management Page**

1. Document Classification Management Page
   - Page Layout: Use a card layout, with each card displaying a document classification.
   - Interaction Design: Users click on the classification card, and the page jumps to the corresponding document classification details page.
   - Provide an "Add" operation button on the page. Clicking it will pop up a _dialog_, where users can enter a name to add a document classification.
   - Provide "Details", "Edit", and "Delete" operation buttons on each classification card, allowing users to perform corresponding renaming and deletion operations.

     - Details button: Jump to the corresponding document classification details page.
     - Edit button: Clicking it will pop up a _dialog_, where users can enter a name.
     - Delete button: Clicking it will pop up a _popconfirm_, which includes confirm and cancel buttons. If the confirm button is clicked again, the deletion will be executed.

2. Subpage: **Document Classification Details Page**

   - Page Layout: Display all documents under this classification in a card format.
   - Provide "View / Edit" and "Delete" operation buttons on each document card, allowing users to perform corresponding renaming and deletion operations.

     - View / Edit button: Clicking it will pop up the _Document Details modal_.
     - Delete button: Clicking it will pop up a _popconfirm_, which includes confirm and cancel buttons. If the confirm button is clicked again, the deletion will be executed.

### Components

1. **Document Details Modal Dialog**

   - Dialog Content: Display the OCR recognition result, classification information, image storage URL, and other information of the document.
   - Operation Options: Support clicking the URL to preview the image and close the dialog. When submitting the _modal_, modify the corresponding information of the document based on the information in the _modal_.

     - Submit button: Modify the corresponding information of the document based on the information in the _modal_.
     - Cancel button: Exit the _modal_.

2. **Navigation Bar**

   - Design: The navigation bar is fixed on the left side of the page, vertically laid out.
   - Content: Includes the following buttons:

     - Home: Jump to the home page.
     - Upload Document: Jump to the upload document page.
     - Search Document: Jump to the search document page.
     - Document Classification Management: Jump to the document classification management page.

   - Implemented by configuring the `routes` parameter in `frontend/.umirc.ts`